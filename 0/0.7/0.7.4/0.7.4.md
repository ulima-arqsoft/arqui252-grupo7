> [0. Acerca del Grupo](../../0.md) ‚Ä∫ [0.7. Trabajo Individual (Patrones Cloud)](../0.7.md) ‚Ä∫ [0.7.4. Integrante 4](0.7.4.md)

# 0.7.4. Integrante 4

# Informe Individual ‚Äì Patr√≥n Cloud: Cache-Aside

**Nombre:** Hideki Sotero Huaroto  
**Curso:** Arquitectura de Software  
**Docente:** Jose Caballero Ortiz  
**Tema aprobado:** Cache-Aside

---

## 1. Problema

En sistemas con alta lectura como cat√°logos, busquedas frecuentes, dashboards o pricing, las consultas directas a la base de datos pueden generar un cuello de botella. Esto puede ocasionar:

- Latencia elevada al consultar tablas grandes o con joins completos.
- Costos por uso intensivo del motor de base de datos (DBaaS).
- Riego de degradaci√≥n bajo picos s√∫bitos de tr√°fico (hot keys / hot rows).

Se necesita acelerar lecturas y reducir carga sobre el origen de datos sin reescribir la l√≥gica de negocio completa ni sacrificar consistencia m√°s all√° de lo razonable.

---

## 2. Soluci√≥n (Patr√≥n Cache-Aside)

El patr√≥n Cache-Aside, tambi√©n conocido como ***lazy caching***, propone que la aplicaci√≥n gestione explicitamente el ciclo "leer del cach√© --> si no existe, leer de la DB --> poblar cach√©" y "invalidar cach√© en escrituras".

**Flujo de lectura (GET):**
1. La app intenta leer la clave en cach√© (GET product:123).
2. Si HIT, devuelve el valor inmediatamente.
3. Si MISS, consulta la DB, devuelve el resultado y escribe en cach√© con TTL.

**Flujo de escritura/actualizaci√≥n (PUT/POST/DELETE):**
1. La app escribe en la DB como fuente de verdad.
2. Invalida/actualiza la entrada en cach√© asociada (p. ej., DEL product:123 o SET product:123 con nueva versi√≥n).

**Ventajas clave:**
- Acelera lecturas ‚Äúcalientes‚Äù con latencias de ms/sub-ms (Redis).
- Reduce presi√≥n sobre la DB y suaviza picos.
- Control expl√≠cito desde la app (no depende de magia del proveedor).

**Riesgos/mitigaciones:**
- Stale data: datos desactualizados hasta expirar TTL ‚Üí reducir TTL, invalidaci√≥n en escritura, refresh-ahead.
- Cache stampede/dogpile: muchos MISS simult√°neos ‚Üí locking, request coalescing, jitter en TTL.
- Key design: claves bien definidas para evitar colisiones y facilitar invalidaci√≥n.

---

## 3. Definici√≥n del patr√≥n Cache-Aside (Microsfot Cloud Patterns)
El patr√≥n Cache-Aside, tambi√©n conocido como ***Lazy Loading***, es uno de los patrones de dise√±o de arquitectura cloud documentados por Microsoft Azure Architecture Center.
Su prop√≥sito es mejorar el rendimiento y la escalabilidad de los sistemas distribuidos almacenando temporalmente los datos m√°s utilizados en un cach√© de alta velocidad, mientras la base de datos subyacente sigue siendo la fuente de verdad (source of truth).

El patr√≥n establece que la aplicaci√≥n controla expl√≠citamente cu√°ndo leer o escribir en el cach√©:

1. **Lectura (Read-Through Manual):**
   - La aplicaci√≥n primero intenta obtener el dato desde el cach√©.
   - Si no existe (cache miss), consulta el origen de datos (por ejemplo, Azure SQL Database) y luego guarda la respuesta en el cach√© (por ejemplo, Azure Cache for Redis).
2. **Escritura o actualizaci√≥n:**
   - Cuando los datos cambian en el origen, la aplicaci√≥n debe invalidar o actualizar manualmente la entrada en el cach√© para mantener coherencia.

### Implementaci√≥n en Azure
En el ecosistema de Azure, este patr√≥n se implementa com√∫nmente con los siguientes servicios:

| **Componente Azure**                               | **Rol dentro del patr√≥n**                                | **Ejemplo de uso**                                            |
| -------------------------------------------------- | -------------------------------------------------------- | ------------------------------------------------------------- |
| **Azure Cache for Redis**                          | Cach√© en memoria que almacena los datos m√°s consultados. | `GET`/`SET` de claves como `product:123`.                     |
| **Azure SQL Database** o **Cosmos DB**             | Origen de verdad (persistencia final).                   | Datos de productos, usuarios o transacciones.                 |
| **Azure Functions / App Service (Node.js o .NET)** | L√≥gica de negocio que aplica el patr√≥n Cache-Aside.      | API que consulta el cach√© y la base de datos seg√∫n necesidad. |
| **Application Insights / Azure Monitor**           | Telemetr√≠a y m√©tricas del cach√© (hits, misses, TTL).     | Monitoreo del rendimiento y la coherencia de datos.           |


---

## 4. Casos de aplicaci√≥n

El patr√≥n Cache-Aside es ampliamente utilizado en sistemas donde las lecturas son mucho m√°s frecuentes que las escrituras, y donde los datos pueden tolerar un grado razonable de desactualizaci√≥n temporal (eventual consistency).

| **Caso de uso**                                   | **Descripci√≥n**                                                                                                              | **Por qu√© aplicar Cache-Aside**                                                                                                                                                                                |
| ---------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Cat√°logo de productos (E-commerce)**               | Un sitio de venta en l√≠nea debe mostrar miles de productos con precios, stock y categor√≠as que cambian pocas veces al d√≠a.      | Los datos se consultan masivamente pero se actualizan poco. Cachear las fichas de producto reduce las lecturas directas a la base de datos y acelera el tiempo de respuesta en las vistas de cat√°logo y b√∫squeda. |
| **Tablas de tarificaci√≥n (Finanzas/Seguros)**        | Aplicaciones financieras o de seguros consultan matrices de precios o coeficientes de riesgo.                                   | Estas tablas cambian cada cierto tiempo (por pol√≠ticas o campa√±as). Al usar cache-aside, se obtienen respuestas inmediatas en los c√°lculos de cotizaci√≥n, reduciendo latencia y costos de consulta.               |
| **Contenido CMS o secciones p√∫blicas de sitios web** | Los portales institucionales y blogs suelen mostrar contenido que cambia pocas veces al d√≠a (noticias, banners, landing pages). | El contenido puede cachearse en memoria (Redis/ElastiCache) con un TTL definido, descargando el servidor de base de datos y reduciendo costos en servicios de hosting o queries SQL.                              |
| **Perfiles de usuario o dashboards de anal√≠tica**    | Aplicaciones con dashboards que muestran datos agregados o informaci√≥n del perfil del usuario tras el inicio de sesi√≥n.         | Las lecturas repetitivas pueden resolverse desde la cach√©, reduciendo consultas al origen. Se invalida el cach√© solo al actualizar los datos del usuario o cuando expira el TTL.                                  |
| **Resultados de consultas o reportes pesados**       | Consultas anal√≠ticas que combinan grandes vol√∫menes de datos (por ejemplo, reportes de ventas o KPIs).                          | Cachear el resultado de una consulta costosa ahorra recursos de CPU y I/O en la base de datos, manteniendo una respuesta r√°pida para el usuario final.                                                            |

### Atributos de calidad mejorados
El patr√≥n Cache-Aside contribuye directamente a varios atributos de calidad del sistema:
- Rendimiento: latencias muy bajas.
- Escalabilidad: reduce carga a DB ‚Üí m√°s usuarios con el mismo cluster.
- Disponibilidad: el sistema degrada con cach√© aun si la DB est√° tensa (no si cae por completo, salvo fallbacks).
- Costo: menos CPU/IO en DB gestionada.

---

## 5. Aplicaci√≥n en el proyecto grupal (E-Commerce de Ropa)
El proyecto grupal consiste en el desarrollo de un e-commerce de ropa, donde los usuarios pueden navegar por el cat√°logo, filtrar productos, gestionar su carrito y realizar compras en l√≠nea.
En este contexto, el patr√≥n Cache-Aside se aplica para mejorar el rendimiento del cat√°logo y las consultas frecuentes, optimizando la experiencia del usuario y reduciendo la carga sobre la base de datos principal.

### M√≥dulos donde se puede aplicar el patr√≥n

| **M√≥dulo / Componente**                            | **Datos a cachear**                                      | **Motivo de uso**                                                                                                                                                  |
| -------------------------------------------------- | -------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Cat√°logo de productos**                      | Lista de productos, tallas, precios, im√°genes y stock.   | Los usuarios consultan repetidamente la misma informaci√≥n. Cachear el cat√°logo reduce el tiempo de carga de la tienda y la cantidad de queries a la base de datos. |
| **Filtros y categor√≠as**                        | Tipos de prenda, colecciones, colores, rangos de precio. | Estas listas cambian muy poco, por lo que se pueden almacenar temporalmente en Redis con TTL alto.                                                                 |
| **Productos destacados / m√°s vendidos**          | Rankings generados por anal√≠tica o ventas recientes.     | Mejorar la carga de la p√°gina principal evitando consultas agregadas costosas.                                                                                     |
| **Perfil del usuario (lectura)**                | Datos del usuario y su historial de pedidos.             | Permite mostrar r√°pidamente el panel de usuario, mientras las actualizaciones invalidan la cach√©.                                                                  |

### Dise√±o propuesto
- Tecnolog√≠a: Redis (como base de datos clave-valor en memoria).
- Modo: Cache-Aside (lazy loading).
- Claves definidas:
  - product:{id} ‚Üí detalle individual del producto.
  - catalog:page:{n} ‚Üí resultados paginados del cat√°logo.
  - filters:categories ‚Üí filtros de b√∫squeda.
  - discounts:active ‚Üí promociones y descuentos activos.

### Flujo de trabajo:
1. El cliente solicita la informaci√≥n al backend (Node.js + Express).
2. El backend busca primero en Redis si la informaci√≥n est√° cacheada (GET).
3. Si existe (HIT), devuelve la respuesta inmediata.
4. Si no existe (MISS), consulta la base de datos, devuelve el resultado al cliente y guarda en Redis con TTL.
5. Cuando se actualiza un producto, promoci√≥n o categor√≠a, el backend invalida la clave afectada (DEL product:{id}), garantizando que la pr√≥xima lectura obtenga los datos actualizados.

### Beneficios esperados
- Rendimiento: reducci√≥n de la latencia promedio en consultas de cat√°logo de 300-500 ms a menos de 50 ms.
- Escalabilidad: menos carga sobre la base de datos relacional (MySQL/PostgreSQL).
- Disponibilidad: la aplicaci√≥n puede seguir sirviendo contenido desde la cach√© incluso bajo alto tr√°fico.
- Costo: ahorro en recursos del servidor y consultas SQL repetitivas.

---

## 6. Demo

La funcionalidad de la demo y su dise√±o se explica con mayor detalle en el es siguiente [README](../0.7.4/Demo.md)

Asimismo se presenta un video sobre el concepto del patr√≥n cache-aside y la demo desarrollada. [DEMO](https://www.youtube.com/watch?v=rowMuCOExXk)

---

[‚¨ÖÔ∏è Anterior](../0.7.3/0.7.3.md) | [üè† Home](../../../README.md) | [Siguiente ‚û°Ô∏è](../0.7.5/0.7.5.md)